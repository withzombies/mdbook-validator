{"id":"mdbook-validator-924","content_hash":"4830f3e01583c09a5c963622c2c0b6c94a9be8bb6f7308e4db5169cde034ea1e","title":"Task 1: Create Cargo.toml with dependencies and lint configuration","description":"","design":"## Goal\nCreate a complete Cargo.toml with all dependencies from CLAUDE.md, thiserror for typed errors, cargo-husky for git hooks, and strict clippy pedantic configuration.\n\n## Effort Estimate\n2-4 hours\n\n## Implementation Checklist\n\n### Step 1: Create Cargo.toml\nCreate file at: `/Users/ryan/src/mdbook-validator/Cargo.toml`\n\nContent:\n```toml\n[package]\nname = \"mdbook-validator\"\nversion = \"0.1.0\"\nedition = \"2021\"\nrust-version = \"1.75.0\"\ndescription = \"An mdBook preprocessor that validates code blocks using Docker containers\"\nlicense = \"MIT OR Apache-2.0\"\n\n[dependencies]\nmdbook = \"0.4\"\nanyhow = \"1.0\"\nthiserror = \"1.0\"\nserde = { version = \"1.0\", features = [\"derive\"] }\nserde_json = \"1.0\"\npulldown-cmark = \"0.13\"\npulldown-cmark-to-cmark = \"21\"\ntestcontainers = { version = \"0.23\", features = [\"blocking\"] }\ntracing = \"0.1\"\ntracing-subscriber = \"0.3\"\n\n[dev-dependencies]\ncargo-husky = { version = \"1.5\", features = [\"precommit-hook\", \"run-cargo-clippy\", \"run-cargo-fmt\"] }\n\n[lints.clippy]\npedantic = { level = \"deny\", priority = -1 }\nmissing_errors_doc = \"allow\"\nmissing_panics_doc = \"allow\"\nmodule_name_repetitions = \"allow\"\nmust_use_candidate = \"allow\"\n\n[lints.rust]\nunsafe_code = \"deny\"\n```\n\n### Step 2: Create src/main.rs\nCreate file at: `/Users/ryan/src/mdbook-validator/src/main.rs`\n\nContent:\n```rust\n//\\! mdbook-validator CLI entry point\n\nfn main() {\n    println\\!(\"mdbook-validator\");\n}\n```\n\n### Step 3: Create src/lib.rs\nCreate file at: `/Users/ryan/src/mdbook-validator/src/lib.rs`\n\nContent:\n```rust\n//\\! mdbook-validator library\n//\\!\n//\\! An mdBook preprocessor that validates code blocks using Docker containers.\n\n// Module declarations will be added as implementation progresses\n```\n\n### Step 4: Verify build\nRun: `cargo build`\nExpected: Compiles with 0 errors, 0 warnings\n\n### Step 5: Verify clippy\nRun: `cargo clippy --all-targets -- -D warnings`\nExpected: Exits 0 with no warnings\n\n## Success Criteria\n- [ ] `cargo build` exits 0 with no errors or warnings\n- [ ] `cargo clippy --all-targets -- -D warnings` exits 0\n- [ ] `cargo metadata --format-version 1 | jq '.packages[0].dependencies | length'` shows 10 dependencies\n- [ ] `grep -c 'pedantic.*deny' Cargo.toml` returns 1\n- [ ] `grep 'rust-version' Cargo.toml` shows \"1.75.0\"\n- [ ] src/main.rs exists and compiles\n- [ ] src/lib.rs exists and compiles\n\n## Key Considerations (SRE Review)\n\n**Edge Case: cargo-husky hook installation**\n- cargo-husky installs git hooks on first `cargo test` (not cargo build)\n- This is expected behavior - hooks will be installed in a later task\n- Do NOT run `cargo test` in this task (cargo-husky not fully configured yet)\n\n**Edge Case: Dependency version conflicts**\n- All versions specified are compatible based on CLAUDE.md research\n- If lock file shows conflicts: check testcontainers features first\n- testcontainers 0.23 with blocking feature is correct\n\n**Edge Case: MSRV compatibility**\n- rust-version = \"1.75.0\" is conservative MSRV (stable as of Dec 2023)\n- All dependencies support this MSRV\n- If build fails on older toolchain: upgrade rustc, don't lower MSRV\n\n**Reference: CLAUDE.md dependencies section**\n- Line 382-395 specifies exact dependency versions\n- This task adds thiserror (not in CLAUDE.md) and cargo-husky (dev-dep)\n\n## Anti-Patterns (FORBIDDEN)\n- NO wildcard versions (use \"1.0\" not \"*\")\n- NO missing features (testcontainers MUST have blocking)\n- NO running cargo test yet (cargo-husky not configured)\n- NO edition = \"2024\" (not stable yet)\n- NO lowering MSRV to fix issues (upgrade toolchain instead)","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-25T17:47:16.328985-05:00","updated_at":"2025-11-26T11:58:02.29847-05:00","closed_at":"2025-11-26T11:58:02.29847-05:00","source_repo":".","dependencies":[{"issue_id":"mdbook-validator-924","depends_on_id":"mdbook-validator-wkm","type":"parent-child","created_at":"2025-11-25T17:47:16.871389-05:00","created_by":"ryan"}]}
{"id":"mdbook-validator-d4u","content_hash":"189b1e35860fd4b0f33a1d873401faf53fb9d0eb5255b36965e6c7c74d3aa722","title":"Task 2: Create rustfmt.toml with Edition 2021 style","description":"","design":"## Goal\nCreate rustfmt.toml with Edition 2021 formatting rules as specified in epic requirements.\n\n## Effort Estimate\n30 minutes\n\n## Implementation Checklist\n\n### Step 1: Create rustfmt.toml\nCreate file at: `/Users/ryan/src/mdbook-validator/rustfmt.toml`\n\nContent:\n```toml\nedition = \"2021\"\n\n# Line width\nmax_width = 100\n\n# Import organization\nreorder_imports = true\ngroup_imports = \"StdExternalCrate\"\nimports_granularity = \"Module\"\n```\n\n### Step 2: Verify cargo fmt --check passes\nRun: `cargo fmt --check`\nExpected: Exit 0 (no formatting changes needed)\n\n### Step 3: Run cargo fmt to format existing files\nRun: `cargo fmt`\nThen verify: `cargo fmt --check` exits 0\n\n## Success Criteria\n- [ ] rustfmt.toml exists with correct content\n- [ ] `cargo fmt --check` exits 0\n- [ ] `grep 'edition.*2021' rustfmt.toml` returns match\n- [ ] `grep 'max_width.*100' rustfmt.toml` returns match\n- [ ] `grep 'imports_granularity.*Module' rustfmt.toml` returns match\n\n## Key Considerations (SRE Review)\n\n**Edge Case: Existing code not formatted**\n- src/main.rs and src/lib.rs may not match new format\n- Run `cargo fmt` after creating config to fix any mismatches\n- Then verify `cargo fmt --check` passes\n\n**Anti-pattern reminder from epic**\n- NO edition = \"2024\" (not stable yet)\n- Use edition = \"2021\"\n\n## Anti-Patterns (FORBIDDEN)\n- NO edition = \"2024\" (explicitly forbidden in epic)\n- NO style_edition field (use edition only)\n- NO unstable rustfmt features","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-26T11:58:19.377925-05:00","updated_at":"2025-11-26T12:07:16.134362-05:00","closed_at":"2025-11-26T12:07:16.134362-05:00","source_repo":".","dependencies":[{"issue_id":"mdbook-validator-d4u","depends_on_id":"mdbook-validator-wkm","type":"parent-child","created_at":"2025-11-26T11:58:25.824153-05:00","created_by":"ryan"},{"issue_id":"mdbook-validator-d4u","depends_on_id":"mdbook-validator-924","type":"blocks","created_at":"2025-11-26T11:58:26.371727-05:00","created_by":"ryan"}]}
{"id":"mdbook-validator-wkm","content_hash":"3fdfd034bd2e63cb21c80be2ff58b8bfe58343f31e777e85bfb41f2c5e604669","title":"Epic: Project Scaffolding with Strict Linting and First-Class Testing","description":"","design":"## Requirements (IMMUTABLE)\n\n1. **Cargo.toml** with all dependencies from CLAUDE.md plus:\n   - thiserror for typed errors\n   - cargo-husky dev-dependency with precommit-hook feature\n   - [lints.clippy] section with pedantic deny + common allowed exceptions\n\n2. **rustfmt.toml** with Edition 2021 style:\n   - max_width = 100\n   - imports_granularity = Module\n   - group_imports = StdExternalCrate\n\n3. **deny.toml** for dependency scanning:\n   - Deny unlicensed, deny unknown registry\n   - Allow MIT, Apache-2.0, BSD-2/3-Clause, ISC, Zlib, Unicode-3.0\n   - Warn on unmaintained, deny vulnerabilities\n\n4. **.config/nextest.toml** with profiles:\n   - default: parallel tests, 60s timeout\n   - docker-integration: sequential (test-threads=1), 5min timeout\n\n5. **Pre-commit hooks** (.cargo-husky/hooks/):\n   - pre-commit: cargo fmt --check, cargo clippy -D warnings, cargo nextest run\n   - pre-push: full test suite including Docker integration tests\n\n6. **Source files** (skeleton with proper module structure):\n   - src/main.rs - CLI entry point\n   - src/lib.rs - public API re-exports\n   - src/error.rs - thiserror error types\n   - src/preprocessor.rs - empty Preprocessor impl stub\n   - src/parser.rs, transpiler.rs, validator.rs, container.rs, config.rs - module stubs\n\n7. **Test structure**:\n   - tests/integration_tests.rs - integration test skeleton\n   - tests/fixtures/test-book/ - minimal mdbook for testing\n\n## Success Criteria (MUST ALL BE TRUE)\n- [ ] cargo build compiles without warnings\n- [ ] cargo fmt --check passes\n- [ ] cargo clippy --all-targets -- -D warnings passes\n- [ ] cargo deny check passes (all dependencies licensed correctly)\n- [ ] cargo nextest run passes (even if tests are empty)\n- [ ] Pre-commit hook runs successfully on commit\n- [ ] File structure matches CLAUDE.md specification\n- [ ] All source files have proper module declarations\n\n## Anti-Patterns (FORBIDDEN)\n- NO edition = 2024 in rustfmt.toml (not stable yet)\n- NO #![allow(clippy::pedantic)] at crate level (defeats purpose)\n- NO :latest container tags in any config\n- NO Python dependencies (use cargo-husky, not pre-commit framework)\n- NO placeholder TODOs without clear next steps\n- NO skipping cargo-deny setup (license compliance required)\n- NO empty test files that do not compile\n\n## Approach\nCreate a production-ready Rust project scaffold that enforces code quality from day one. Use cargo-husky for git hooks (Rust-native), clippy pedantic for strict linting, cargo-deny for dependency safety, and cargo-nextest for fast parallel testing. All configuration follows 2024/2025 best practices research.\n\n## Architecture\n- Binary crate (mdbook-validator) with library portion for testing\n- thiserror for typed errors (testable), anyhow for error context in main\n- Modules follow CLAUDE.md file organization exactly\n- Pre-commit validates formatting and linting; pre-push validates full test suite including Docker tests\n\n## Context\n- CLAUDE.md specifies exact file organization and dependencies\n- testcontainers-rs 0.23 with blocking feature for container management\n- mdbook 0.4 for preprocessor interface\n- pulldown-cmark 0.13 + pulldown-cmark-to-cmark 21 for markdown","status":"open","priority":0,"issue_type":"epic","created_at":"2025-11-25T17:47:03.653513-05:00","updated_at":"2025-11-25T17:47:03.653513-05:00","source_repo":"."}
{"id":"mdbook-validator-x82","content_hash":"6c9782f2339ba8410cf350991bc904166121e0bcd99696c95e3f2a8e8fb844e7","title":"Task 3: Create deny.toml for dependency scanning","description":"","design":"## Goal\nCreate deny.toml for cargo-deny dependency scanning as specified in epic requirements.\n\n## Effort Estimate\n30 minutes\n\n## Context\nCompleted Task 1: Cargo.toml with dependencies\nCompleted Task 2: rustfmt.toml with Edition 2021 style\n\n## Implementation Checklist\n\n### Step 1: Check if cargo-deny is installed\nRun: `cargo deny --version`\nIf not installed: `cargo install cargo-deny`\n\n### Step 2: Create deny.toml\nCreate file at: `/Users/ryan/src/mdbook-validator/deny.toml`\n\nContent:\n```toml\n[graph]\nall-features = true\n\n[advisories]\ndb-path = \"~/.cargo/advisory-db\"\nvulnerability = \"deny\"\nunmaintained = \"warn\"\nyanked = \"warn\"\nnotice = \"warn\"\nignore = []\n\n[licenses]\nunlicensed = \"deny\"\nallow = [\n    \"MIT\",\n    \"Apache-2.0\",\n    \"Apache-2.0 WITH LLVM-exception\",\n    \"BSD-2-Clause\",\n    \"BSD-3-Clause\",\n    \"ISC\",\n    \"Zlib\",\n    \"Unicode-3.0\",\n    \"Unicode-DFS-2016\",\n    \"MPL-2.0\",\n]\ncopyleft = \"warn\"\nconfidence-threshold = 0.8\nexceptions = []\n\n[bans]\nmultiple-versions = \"warn\"\nwildcards = \"deny\"\nhighlight = \"all\"\nworkspace-default-features = \"allow\"\nexternal-default-features = \"allow\"\n\n[sources]\nunknown-registry = \"deny\"\nunknown-git = \"warn\"\nallow-registry = [\"https://github.com/rust-lang/crates.io-index\"]\n```\n\n### Step 3: Run cargo deny check\nRun: `cargo deny check`\nExpected: Exit 0 (or warnings only, no errors)\n\nIf failures occur:\n- License issues: Check if license is in allow list, add if standard OSS\n- Advisory issues: Check RUSTSEC advisory, decide if exception needed\n- Source issues: Verify registry is crates.io\n\n### Step 4: Commit changes\n\n## Success Criteria\n- [ ] deny.toml exists at project root\n- [ ] `cargo deny check` exits 0 (no denials, warnings OK)\n- [ ] `grep 'unlicensed.*deny' deny.toml` returns match\n- [ ] `grep 'unknown-registry.*deny' deny.toml` returns match\n- [ ] `grep 'vulnerability.*deny' deny.toml` returns match\n- [ ] `grep 'unmaintained.*warn' deny.toml` returns match\n\n## Key Considerations (SRE Review)\n\n**Edge Case: cargo-deny not installed**\n- Check with `cargo deny --version` first\n- Install with `cargo install cargo-deny`\n- First run downloads advisory-db (~30s)\n\n**Edge Case: Dual-licensed dependencies**\n- Many crates are \"MIT OR Apache-2.0\"\n- cargo-deny handles this correctly if either is in allow list\n- Both MIT and Apache-2.0 are in our allow list\n\n**Edge Case: RUSTSEC advisories on dependencies**\n- Check https://rustsec.org/ for known advisories\n- If critical advisory on our deps, may need to update dependency\n- Use `cargo deny check advisories` to check just advisories\n\n**Edge Case: Unicode licenses**\n- unicode-ident crate uses Unicode-3.0 and Unicode-DFS-2016\n- Both must be in allow list\n- Already included in our config\n\n**Why these specific licenses?**\n- MIT, Apache-2.0: Most Rust ecosystem\n- BSD-2/3-Clause, ISC: Common permissive\n- Zlib: Compression libraries\n- Unicode-3.0, Unicode-DFS-2016: Unicode libraries\n- MPL-2.0: Some networking crates (tokio ecosystem)\n- Apache WITH LLVM-exception: LLVM-based crates\n\n## Anti-Patterns (FORBIDDEN)\n- NO skipping cargo-deny setup (epic explicitly requires)\n- NO allowing all licenses (defeats purpose)\n- NO ignoring vulnerabilities (security risk)\n- NO `deny = false` on any security check\n- NO empty allow list (would deny everything)","status":"open","priority":0,"issue_type":"feature","created_at":"2025-11-26T12:07:38.532439-05:00","updated_at":"2025-11-26T12:08:21.92106-05:00","source_repo":".","dependencies":[{"issue_id":"mdbook-validator-x82","depends_on_id":"mdbook-validator-wkm","type":"parent-child","created_at":"2025-11-26T12:07:43.936111-05:00","created_by":"ryan"},{"issue_id":"mdbook-validator-x82","depends_on_id":"mdbook-validator-d4u","type":"blocks","created_at":"2025-11-26T12:07:45.74563-05:00","created_by":"ryan"}]}
