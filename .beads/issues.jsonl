{"id":"mdbook-validator-924","content_hash":"4830f3e01583c09a5c963622c2c0b6c94a9be8bb6f7308e4db5169cde034ea1e","title":"Task 1: Create Cargo.toml with dependencies and lint configuration","description":"","design":"## Goal\nCreate a complete Cargo.toml with all dependencies from CLAUDE.md, thiserror for typed errors, cargo-husky for git hooks, and strict clippy pedantic configuration.\n\n## Effort Estimate\n2-4 hours\n\n## Implementation Checklist\n\n### Step 1: Create Cargo.toml\nCreate file at: `/Users/ryan/src/mdbook-validator/Cargo.toml`\n\nContent:\n```toml\n[package]\nname = \"mdbook-validator\"\nversion = \"0.1.0\"\nedition = \"2021\"\nrust-version = \"1.75.0\"\ndescription = \"An mdBook preprocessor that validates code blocks using Docker containers\"\nlicense = \"MIT OR Apache-2.0\"\n\n[dependencies]\nmdbook = \"0.4\"\nanyhow = \"1.0\"\nthiserror = \"1.0\"\nserde = { version = \"1.0\", features = [\"derive\"] }\nserde_json = \"1.0\"\npulldown-cmark = \"0.13\"\npulldown-cmark-to-cmark = \"21\"\ntestcontainers = { version = \"0.23\", features = [\"blocking\"] }\ntracing = \"0.1\"\ntracing-subscriber = \"0.3\"\n\n[dev-dependencies]\ncargo-husky = { version = \"1.5\", features = [\"precommit-hook\", \"run-cargo-clippy\", \"run-cargo-fmt\"] }\n\n[lints.clippy]\npedantic = { level = \"deny\", priority = -1 }\nmissing_errors_doc = \"allow\"\nmissing_panics_doc = \"allow\"\nmodule_name_repetitions = \"allow\"\nmust_use_candidate = \"allow\"\n\n[lints.rust]\nunsafe_code = \"deny\"\n```\n\n### Step 2: Create src/main.rs\nCreate file at: `/Users/ryan/src/mdbook-validator/src/main.rs`\n\nContent:\n```rust\n//\\! mdbook-validator CLI entry point\n\nfn main() {\n    println\\!(\"mdbook-validator\");\n}\n```\n\n### Step 3: Create src/lib.rs\nCreate file at: `/Users/ryan/src/mdbook-validator/src/lib.rs`\n\nContent:\n```rust\n//\\! mdbook-validator library\n//\\!\n//\\! An mdBook preprocessor that validates code blocks using Docker containers.\n\n// Module declarations will be added as implementation progresses\n```\n\n### Step 4: Verify build\nRun: `cargo build`\nExpected: Compiles with 0 errors, 0 warnings\n\n### Step 5: Verify clippy\nRun: `cargo clippy --all-targets -- -D warnings`\nExpected: Exits 0 with no warnings\n\n## Success Criteria\n- [ ] `cargo build` exits 0 with no errors or warnings\n- [ ] `cargo clippy --all-targets -- -D warnings` exits 0\n- [ ] `cargo metadata --format-version 1 | jq '.packages[0].dependencies | length'` shows 10 dependencies\n- [ ] `grep -c 'pedantic.*deny' Cargo.toml` returns 1\n- [ ] `grep 'rust-version' Cargo.toml` shows \"1.75.0\"\n- [ ] src/main.rs exists and compiles\n- [ ] src/lib.rs exists and compiles\n\n## Key Considerations (SRE Review)\n\n**Edge Case: cargo-husky hook installation**\n- cargo-husky installs git hooks on first `cargo test` (not cargo build)\n- This is expected behavior - hooks will be installed in a later task\n- Do NOT run `cargo test` in this task (cargo-husky not fully configured yet)\n\n**Edge Case: Dependency version conflicts**\n- All versions specified are compatible based on CLAUDE.md research\n- If lock file shows conflicts: check testcontainers features first\n- testcontainers 0.23 with blocking feature is correct\n\n**Edge Case: MSRV compatibility**\n- rust-version = \"1.75.0\" is conservative MSRV (stable as of Dec 2023)\n- All dependencies support this MSRV\n- If build fails on older toolchain: upgrade rustc, don't lower MSRV\n\n**Reference: CLAUDE.md dependencies section**\n- Line 382-395 specifies exact dependency versions\n- This task adds thiserror (not in CLAUDE.md) and cargo-husky (dev-dep)\n\n## Anti-Patterns (FORBIDDEN)\n- NO wildcard versions (use \"1.0\" not \"*\")\n- NO missing features (testcontainers MUST have blocking)\n- NO running cargo test yet (cargo-husky not configured)\n- NO edition = \"2024\" (not stable yet)\n- NO lowering MSRV to fix issues (upgrade toolchain instead)","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-25T17:47:16.328985-05:00","updated_at":"2025-11-26T11:58:02.29847-05:00","closed_at":"2025-11-26T11:58:02.29847-05:00","source_repo":".","dependencies":[{"issue_id":"mdbook-validator-924","depends_on_id":"mdbook-validator-wkm","type":"parent-child","created_at":"2025-11-25T17:47:16.871389-05:00","created_by":"ryan"}]}
{"id":"mdbook-validator-b8e","content_hash":"d1dabc9d7206fd191067bde32c8c3b49b81d935b41c109a8f9539016ef64f5e4","title":"Task 7: Create test structure with integration test skeleton","description":"","design":"## Goal\nCreate test structure with integration test skeleton and test fixtures as specified in epic requirements.\n\n## Effort Estimate\n30 minutes\n\n## Context\nCompleted Task 1-6. All source files exist and compile.\nNeed: Test files that compile and can be run with nextest.\n\n## Implementation Checklist\n\n### Step 1: Create tests directory\nRun: `mkdir -p tests/fixtures/test-book/src`\n\n### Step 2: Create tests/integration_tests.rs\nFile: /Users/ryan/src/mdbook-validator/tests/integration_tests.rs\n\nContent:\n```rust\n//! Integration tests for mdbook-validator\n\nuse mdbook::preprocess::Preprocessor;\nuse mdbook_validator::ValidatorPreprocessor;\n\n#[test]\nfn preprocessor_has_correct_name() {\n    let preprocessor = ValidatorPreprocessor::new();\n    assert_eq!(preprocessor.name(), \"validator\");\n}\n\n#[test]\nfn preprocessor_supports_html_renderer() {\n    let preprocessor = ValidatorPreprocessor::new();\n    assert!(preprocessor.supports_renderer(\"html\"));\n}\n\n#[test]\nfn preprocessor_does_not_support_other_renderers() {\n    let preprocessor = ValidatorPreprocessor::new();\n    assert!(!preprocessor.supports_renderer(\"pdf\"));\n    assert!(!preprocessor.supports_renderer(\"epub\"));\n}\n```\n\n### Step 3: Create test-book fixture - book.toml\nFile: tests/fixtures/test-book/book.toml\n\nContent:\n```toml\n[book]\ntitle = \"Test Book\"\nauthors = [\"Test\"]\n\n[preprocessor.validator]\ncommand = \"mdbook-validator\"\n```\n\n### Step 4: Create test-book fixture - SUMMARY.md\nFile: tests/fixtures/test-book/src/SUMMARY.md\n\nContent:\n```markdown\n# Summary\n\n- [Chapter 1](./chapter_1.md)\n```\n\n### Step 5: Create test-book fixture - chapter_1.md\nFile: tests/fixtures/test-book/src/chapter_1.md\n\nContent (note: code block uses sql validator=sqlite):\n```markdown\n# Chapter 1\n\nThis is a test chapter with a validatable code block.\n\n` ` `sql validator=sqlite\nSELECT 1;\n` ` `\n```\n(Remove spaces between backticks when creating file)\n\n### Step 6: Verify tests compile and pass\nRun: `cargo nextest run`\nExpected: 3 tests pass\n\n### Step 7: Verify test count\nRun: `cargo nextest run 2\u003e\u00261 | grep -E \"^[0-9]+ tests\"`\nExpected: Shows \"3 tests\" or similar\n\n### Step 8: Commit changes\n\n## Success Criteria\n- [ ] tests/integration_tests.rs exists and compiles\n- [ ] tests/fixtures/test-book/book.toml exists with valid TOML\n- [ ] tests/fixtures/test-book/src/SUMMARY.md exists\n- [ ] tests/fixtures/test-book/src/chapter_1.md exists with code block\n- [ ] `cargo nextest run` passes\n- [ ] Exactly 3 tests exist: `cargo nextest list 2\u003e\u00261 | grep -c \"test$\"` returns 3\n\n## Key Considerations (SRE Review)\n\n**Edge Case: Test file not found by nextest**\n- Tests must be in tests/ directory or have #[cfg(test)] module\n- Integration tests use lib.rs exports, not src/main.rs\n- File must be named with _test.rs suffix or be in tests/ dir\n\n**Edge Case: Test book fixture validation**\n- Test book structure must be valid mdbook format\n- SUMMARY.md is required for mdbook\n- Fixture won't be used by tests until preprocessor run() is implemented\n- For now: Fixture exists for future integration tests\n\n**Edge Case: Markdown code block in design**\n- Code blocks containing triple backticks need special handling\n- When copying chapter_1.md content, ensure backticks are not escaped\n- Triple backticks in markdown cannot be nested directly\n\n**Why only 3 tests?**\n- These are skeleton tests verifying basic preprocessor structure\n- More tests will be added as functionality is implemented\n- Goal is: tests exist and pass, enabling pre-commit hook\n\n## Anti-Patterns (FORBIDDEN)\n- NO empty test files that do not compile\n- NO tests using todo!() or unimplemented!()\n- NO tests that are always skipped (#[ignore] without reason)\n- NO test fixtures with invalid mdbook structure","status":"open","priority":0,"issue_type":"feature","created_at":"2025-11-26T12:32:44.162482-05:00","updated_at":"2025-11-26T12:34:04.516752-05:00","source_repo":".","dependencies":[{"issue_id":"mdbook-validator-b8e","depends_on_id":"mdbook-validator-wkm","type":"parent-child","created_at":"2025-11-26T12:32:49.077653-05:00","created_by":"ryan"},{"issue_id":"mdbook-validator-b8e","depends_on_id":"mdbook-validator-fvz","type":"blocks","created_at":"2025-11-26T12:32:49.591757-05:00","created_by":"ryan"}]}
{"id":"mdbook-validator-d4u","content_hash":"189b1e35860fd4b0f33a1d873401faf53fb9d0eb5255b36965e6c7c74d3aa722","title":"Task 2: Create rustfmt.toml with Edition 2021 style","description":"","design":"## Goal\nCreate rustfmt.toml with Edition 2021 formatting rules as specified in epic requirements.\n\n## Effort Estimate\n30 minutes\n\n## Implementation Checklist\n\n### Step 1: Create rustfmt.toml\nCreate file at: `/Users/ryan/src/mdbook-validator/rustfmt.toml`\n\nContent:\n```toml\nedition = \"2021\"\n\n# Line width\nmax_width = 100\n\n# Import organization\nreorder_imports = true\ngroup_imports = \"StdExternalCrate\"\nimports_granularity = \"Module\"\n```\n\n### Step 2: Verify cargo fmt --check passes\nRun: `cargo fmt --check`\nExpected: Exit 0 (no formatting changes needed)\n\n### Step 3: Run cargo fmt to format existing files\nRun: `cargo fmt`\nThen verify: `cargo fmt --check` exits 0\n\n## Success Criteria\n- [ ] rustfmt.toml exists with correct content\n- [ ] `cargo fmt --check` exits 0\n- [ ] `grep 'edition.*2021' rustfmt.toml` returns match\n- [ ] `grep 'max_width.*100' rustfmt.toml` returns match\n- [ ] `grep 'imports_granularity.*Module' rustfmt.toml` returns match\n\n## Key Considerations (SRE Review)\n\n**Edge Case: Existing code not formatted**\n- src/main.rs and src/lib.rs may not match new format\n- Run `cargo fmt` after creating config to fix any mismatches\n- Then verify `cargo fmt --check` passes\n\n**Anti-pattern reminder from epic**\n- NO edition = \"2024\" (not stable yet)\n- Use edition = \"2021\"\n\n## Anti-Patterns (FORBIDDEN)\n- NO edition = \"2024\" (explicitly forbidden in epic)\n- NO style_edition field (use edition only)\n- NO unstable rustfmt features","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-26T11:58:19.377925-05:00","updated_at":"2025-11-26T12:07:16.134362-05:00","closed_at":"2025-11-26T12:07:16.134362-05:00","source_repo":".","dependencies":[{"issue_id":"mdbook-validator-d4u","depends_on_id":"mdbook-validator-wkm","type":"parent-child","created_at":"2025-11-26T11:58:25.824153-05:00","created_by":"ryan"},{"issue_id":"mdbook-validator-d4u","depends_on_id":"mdbook-validator-924","type":"blocks","created_at":"2025-11-26T11:58:26.371727-05:00","created_by":"ryan"}]}
{"id":"mdbook-validator-fvz","content_hash":"a83168ef4317827262341b227ae22e1c0415ddf52e60ae73160cd0574d6c3e79","title":"Task 6: Create pre-commit and pre-push hooks with cargo-husky","description":"","design":"## Goal\nCreate pre-commit and pre-push hooks using cargo-husky as specified in epic requirements.\n\n## Effort Estimate\n30 minutes\n\n## Context\nCompleted Task 1-5. Source files exist and compile.\nNeed: Git hooks to enforce code quality before commits/pushes.\n\n## Implementation Checklist\n\n### Step 1: Verify cargo-husky is in Cargo.toml\nRun: `grep cargo-husky Cargo.toml`\nExpected: cargo-husky in dev-dependencies with precommit-hook feature\n\n### Step 2: Create .cargo-husky/hooks directory\nRun: `mkdir -p .cargo-husky/hooks`\n\n### Step 3: Create pre-commit hook\nFile: /Users/ryan/src/mdbook-validator/.cargo-husky/hooks/pre-commit\n\n```bash\n#!/bin/sh\nset -e\n\necho \"Running pre-commit checks...\"\n\necho \"Checking formatting...\"\ncargo fmt --check\n\necho \"Running clippy...\"\ncargo clippy --all-targets -- -D warnings\n\necho \"Running tests...\"\ncargo nextest run\n\necho \"Pre-commit checks passed!\"\n```\n\n### Step 4: Create pre-push hook\nFile: /Users/ryan/src/mdbook-validator/.cargo-husky/hooks/pre-push\n\n```bash\n#!/bin/sh\nset -e\n\necho \"Running pre-push checks...\"\n\necho \"Running full test suite...\"\ncargo nextest run\n\necho \"Running Docker integration tests...\"\ncargo nextest run --profile docker-integration\n\necho \"Pre-push checks passed!\"\n```\n\n### Step 5: Make hooks executable\nRun: `chmod +x .cargo-husky/hooks/pre-commit .cargo-husky/hooks/pre-push`\n\n### Step 6: Run cargo build to trigger cargo-husky setup\nRun: `cargo build`\nNote: cargo-husky installs hooks on build\n\n### Step 7: Verify hooks are installed\nRun: `ls -la .git/hooks/pre-commit .git/hooks/pre-push`\nExpected: Symlinks or files exist in .git/hooks/\n\n### Step 8: Test pre-commit hook execution\nRun: `git commit --allow-empty -m \"test: verify pre-commit hook\"`\nExpected: Hook runs, shows \"Pre-commit checks passed!\"\nNote: If test passes, amend or delete the test commit\n\n### Step 9: Commit changes\n\n## Success Criteria\n- [ ] .cargo-husky/hooks/pre-commit exists and is executable\n- [ ] .cargo-husky/hooks/pre-push exists and is executable\n- [ ] Pre-commit runs: cargo fmt --check, cargo clippy -D warnings, cargo nextest run\n- [ ] Pre-push runs: cargo nextest run, cargo nextest run --profile docker-integration\n- [ ] .git/hooks/pre-commit exists (installed by cargo-husky or manually)\n- [ ] Pre-commit hook ACTUALLY executes on git commit (verified by test commit)\n\n## Key Considerations (SRE Review)\n\n**Edge Case: cargo-husky not triggering**\n- cargo-husky runs on `cargo build`\n- If hooks not installed after build, check Cargo.toml features\n- May need `cargo clean \u0026\u0026 cargo build` to force reinstall\n- FALLBACK: Manually copy hooks to .git/hooks/ if cargo-husky fails\n\n**Edge Case: Hook permission issues**\n- Hooks must be executable (chmod +x)\n- On Windows, executable bit may not work - alternative needed\n- This project targets macOS/Linux primarily\n\n**Edge Case: nextest not installed**\n- Pre-commit hook requires cargo-nextest\n- If user doesn't have nextest, hook will fail\n- Consider: Add check at start of hook or fall back to `cargo test`\n- For now: Assume nextest installed per dev setup requirements\n\n**Edge Case: Docker not running for pre-push**\n- Pre-push runs docker-integration profile which needs Docker\n- If Docker not running, pre-push will fail\n- This is INTENTIONAL - Docker tests should block push if Docker unavailable\n- Developer must either start Docker or skip push (--no-verify, discouraged)\n\n**Why hooks are in .cargo-husky/hooks/ not .git/hooks/**\n- .cargo-husky/hooks/ is version controlled (shared with team)\n- .git/hooks/ is local only (not shared)\n- cargo-husky copies/links hooks from .cargo-husky/hooks/ to .git/hooks/\n\n## Anti-Patterns (FORBIDDEN)\n- NO Python pre-commit framework\n- NO skipping clippy or fmt checks\n- NO --no-verify bypasses\n- NO fallback to cargo test if nextest unavailable (nextest is required)","status":"in_progress","priority":0,"issue_type":"feature","created_at":"2025-11-26T12:32:21.861505-05:00","updated_at":"2025-11-26T12:49:31.445834-05:00","source_repo":".","dependencies":[{"issue_id":"mdbook-validator-fvz","depends_on_id":"mdbook-validator-wkm","type":"parent-child","created_at":"2025-11-26T12:32:28.341354-05:00","created_by":"ryan"},{"issue_id":"mdbook-validator-fvz","depends_on_id":"mdbook-validator-q9r","type":"blocks","created_at":"2025-11-26T12:32:28.866831-05:00","created_by":"ryan"}]}
{"id":"mdbook-validator-i0t","content_hash":"94484f3d67ea02c8e8d90d8e039642338e4352c676e61e8b68b36d96ce368b30","title":"Task 4: Create .config/nextest.toml with test profiles","description":"","design":"## Goal\nCreate .config/nextest.toml with test profiles as specified in epic requirements.\n\n## Effort Estimate\n20 minutes\n\n## Context\nCompleted Task 1-3: Cargo.toml, rustfmt.toml, deny.toml\nNeed: nextest configuration for parallel and Docker integration tests\n\n## Implementation Checklist\n\n### Step 1: Check if cargo-nextest is installed\nRun: `cargo nextest --version`\nIf not installed: `cargo install cargo-nextest`\nNote: Record version for compatibility check\n\n### Step 2: Create .config directory\nRun: `mkdir -p .config`\n\n### Step 3: Create .config/nextest.toml\nCreate file at: `/Users/ryan/src/mdbook-validator/.config/nextest.toml`\n\nContent:\n```toml\n[profile.default]\n# Run tests in parallel (default behavior)\ntest-threads = \"num-cpus\"\n# Timeout per test\nslow-timeout = { period = \"60s\", terminate-after = 2 }\n# Retry failed tests once\nretries = 1\n\n[profile.docker-integration]\n# Run Docker tests sequentially to avoid container conflicts\ntest-threads = 1\n# Docker tests need longer timeout (container startup)\nslow-timeout = { period = \"300s\", terminate-after = 1 }\n# No retries for integration tests - failures are meaningful\nretries = 0\n```\n\n### Step 4: Verify cargo nextest run passes\nRun: `cargo nextest run`\nExpected: Passes (may say \"no tests\" which is OK at this stage)\n\n### Step 5: Verify docker-integration profile works\nRun: `cargo nextest run --profile docker-integration`\nExpected: Passes (or \"no tests\")\n\n### Step 6: Commit changes\n\n## Success Criteria\n- [ ] .config/nextest.toml exists\n- [ ] `cargo nextest run` exits without config errors\n- [ ] `cargo nextest run --profile docker-integration` exits without config errors\n- [ ] Default profile has parallel tests (test-threads = num-cpus or unset)\n- [ ] docker-integration profile has sequential tests (test-threads = 1)\n- [ ] docker-integration profile has 5min timeout\n\n## Key Considerations (SRE Review)\n\n**Edge Case: nextest version compatibility**\n- Config format may vary between nextest versions\n- If config error occurs, check `cargo nextest --version`\n- Reference current docs: https://nexte.st/book/configuration\n\n**Edge Case: Config parse errors**\n- If nextest rejects config, error message will indicate field\n- Common issue: string vs number for test-threads\n- Use `test-threads = \"num-cpus\"` (string) not `test-threads = num-cpus`\n\n**Edge Case: CI environment**\n- CI may not have cargo-nextest installed\n- Consider adding to CI setup or using `cargo test` fallback\n- This task is local dev only; CI setup is separate concern\n\n**Why these specific values?**\n- `slow-timeout.period = \"60s\"`: Unit tests should be fast; 60s catches hangs\n- `slow-timeout.terminate-after = 2`: Kill after 2x slow period (120s total)\n- `retries = 1` for default: Flaky tests get one retry\n- `retries = 0` for docker: Docker test failures are meaningful, don't mask them\n- `test-threads = 1` for docker: Containers share Docker daemon, avoid conflicts\n\n## Anti-Patterns (FORBIDDEN)\n- NO skipping docker-integration profile\n- NO timeout less than 60s for default profile\n- NO timeout less than 300s for docker-integration profile\n- NO test-threads \u003e 1 for docker-integration (container conflicts)","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-26T12:19:11.776405-05:00","updated_at":"2025-11-26T12:22:21.575183-05:00","closed_at":"2025-11-26T12:22:21.575183-05:00","source_repo":".","dependencies":[{"issue_id":"mdbook-validator-i0t","depends_on_id":"mdbook-validator-wkm","type":"parent-child","created_at":"2025-11-26T12:19:17.473961-05:00","created_by":"ryan"},{"issue_id":"mdbook-validator-i0t","depends_on_id":"mdbook-validator-x82","type":"blocks","created_at":"2025-11-26T12:19:17.99634-05:00","created_by":"ryan"}]}
{"id":"mdbook-validator-q9r","content_hash":"09e87a49d676c7a5519ebe3c92e42a1579ee6a31018ba51cca189f57b00f7537","title":"Task 5: Create source file skeletons with proper module structure","description":"","design":"## Goal\nCreate source file skeletons following CLAUDE.md file organization with proper module declarations that compile.\n\n## Effort Estimate\n45 minutes\n\n## Context\nCompleted Task 1-4: Cargo.toml, rustfmt.toml, deny.toml, nextest.toml\nNext: Need source files before tests and hooks (tests import from lib)\n\n## Why This Order\nPre-commit hooks (Task 6) run cargo clippy and cargo nextest.\nTests (Task 7) import from lib.rs.\nBoth require compilable source files first.\n\n## Implementation Checklist\n\n### Step 1: Create src/error.rs with thiserror types\nFile: /Users/ryan/src/mdbook-validator/src/error.rs\n\n\\`\\`\\`rust\n//! Error types for mdbook-validator\n\nuse thiserror::Error;\n\n/// Errors that can occur during validation\n#[derive(Debug, Error)]\npub enum ValidatorError {\n    /// Failed to parse markdown\n    #[error(\"failed to parse markdown: {0}\")]\n    MarkdownParse(String),\n\n    /// Failed to start container\n    #[error(\"failed to start container '{container}': {source}\")]\n    ContainerStart {\n        container: String,\n        #[source]\n        source: std::io::Error,\n    },\n\n    /// Validation failed\n    #[error(\"validation failed for block at {file}:{line}: {message}\")]\n    ValidationFailed {\n        file: String,\n        line: usize,\n        message: String,\n    },\n\n    /// Configuration error\n    #[error(\"configuration error: {0}\")]\n    Config(String),\n}\n\n/// Result type alias using ValidatorError\npub type Result\u003cT\u003e = std::result::Result\u003cT, ValidatorError\u003e;\n\\`\\`\\`\n\n### Step 2: Create src/config.rs\nFile: /Users/ryan/src/mdbook-validator/src/config.rs\n\n\\`\\`\\`rust\n//! Configuration parsing for book.toml\n\n/// Configuration for a validator\n#[derive(Debug, Clone)]\npub struct ValidatorConfig {\n    /// Container image to use\n    pub container: String,\n    /// Command to run for validation\n    pub validate_command: String,\n}\n\n/// Top-level preprocessor configuration\n#[derive(Debug, Clone, Default)]\npub struct Config {\n    /// Whether to fail on first error\n    pub fail_fast: bool,\n    /// Configured validators by name\n    pub validators: std::collections::HashMap\u003cString, ValidatorConfig\u003e,\n}\n\\`\\`\\`\n\n### Step 3: Create src/parser.rs\nFile: /Users/ryan/src/mdbook-validator/src/parser.rs\n\n\\`\\`\\`rust\n//! Markdown parsing and code block extraction\n\n/// A code block extracted from markdown\n#[derive(Debug, Clone)]\npub struct CodeBlock {\n    /// The language (e.g., \"sql\", \"json\")\n    pub language: String,\n    /// The validator name from \\`validator=\\` attribute\n    pub validator: Option\u003cString\u003e,\n    /// Whether to skip validation\n    pub skip: bool,\n    /// The visible content (without markers)\n    pub content: String,\n    /// Setup content from \u003c!--SETUP--\u003e marker\n    pub setup: Option\u003cString\u003e,\n    /// Assertions from \u003c!--ASSERT--\u003e marker\n    pub assertions: Option\u003cString\u003e,\n    /// Expected output from \u003c!--EXPECT--\u003e marker\n    pub expect: Option\u003cString\u003e,\n}\n\\`\\`\\`\n\n### Step 4: Create src/transpiler.rs\nFile: /Users/ryan/src/mdbook-validator/src/transpiler.rs\n\n\\`\\`\\`rust\n//! Strip validation markers from output\n\n/// Strips all validation markers from a code block, returning clean content\npub fn strip_markers(content: \u0026str) -\u003e String {\n    // Placeholder - will strip \u003c!--SETUP--\u003e, \u003c!--ASSERT--\u003e, \u003c!--EXPECT--\u003e, and @@ lines\n    content.to_string()\n}\n\\`\\`\\`\n\n### Step 5: Create src/container.rs\nFile: /Users/ryan/src/mdbook-validator/src/container.rs\n\n\\`\\`\\`rust\n//! Container lifecycle management using testcontainers\n\nuse crate::config::ValidatorConfig;\n\n/// Manages a validator container\npub struct ValidatorContainer {\n    config: ValidatorConfig,\n}\n\nimpl ValidatorContainer {\n    /// Create a new container manager\n    pub fn new(config: ValidatorConfig) -\u003e Self {\n        Self { config }\n    }\n\n    /// Get the container configuration\n    pub fn config(\u0026self) -\u003e \u0026ValidatorConfig {\n        \u0026self.config\n    }\n}\n\\`\\`\\`\n\n### Step 6: Create src/validator.rs\nFile: /Users/ryan/src/mdbook-validator/src/validator.rs\n\n\\`\\`\\`rust\n//! Orchestrates validation of code blocks\n\nuse crate::parser::CodeBlock;\n\n/// Input sent to validator scripts as JSON\n#[derive(Debug, Clone, serde::Serialize)]\npub struct ValidatorInput {\n    /// Setup content (e.g., CREATE TABLE statements)\n    pub setup: Option\u003cString\u003e,\n    /// The content to validate\n    pub content: String,\n    /// Assertion rules\n    pub assertions: Option\u003cString\u003e,\n    /// Expected output for exact matching\n    pub expect: Option\u003cString\u003e,\n}\n\nimpl From\u003c\u0026CodeBlock\u003e for ValidatorInput {\n    fn from(block: \u0026CodeBlock) -\u003e Self {\n        Self {\n            setup: block.setup.clone(),\n            content: block.content.clone(),\n            assertions: block.assertions.clone(),\n            expect: block.expect.clone(),\n        }\n    }\n}\n\\`\\`\\`\n\n### Step 7: Create src/preprocessor.rs\nFile: /Users/ryan/src/mdbook-validator/src/preprocessor.rs\n\n\\`\\`\\`rust\n//! mdBook preprocessor implementation\n\nuse mdbook::preprocess::{Preprocessor, PreprocessorContext};\nuse mdbook::book::Book;\nuse mdbook::errors::Error;\n\n/// The mdbook-validator preprocessor\npub struct ValidatorPreprocessor;\n\nimpl ValidatorPreprocessor {\n    /// Create a new preprocessor instance\n    pub fn new() -\u003e Self {\n        Self\n    }\n}\n\nimpl Default for ValidatorPreprocessor {\n    fn default() -\u003e Self {\n        Self::new()\n    }\n}\n\nimpl Preprocessor for ValidatorPreprocessor {\n    fn name(\u0026self) -\u003e \u0026str {\n        \"validator\"\n    }\n\n    fn run(\u0026self, _ctx: \u0026PreprocessorContext, book: Book) -\u003e Result\u003cBook, Error\u003e {\n        // Placeholder - will validate code blocks and strip markers\n        Ok(book)\n    }\n\n    fn supports_renderer(\u0026self, renderer: \u0026str) -\u003e bool {\n        renderer == \"html\"\n    }\n}\n\\`\\`\\`\n\n### Step 8: Update src/lib.rs with module declarations\nFile: /Users/ryan/src/mdbook-validator/src/lib.rs\n\n\\`\\`\\`rust\n//! mdbook-validator library\n//!\n//! An mdBook preprocessor that validates code blocks using Docker containers.\n\npub mod config;\npub mod container;\npub mod error;\npub mod parser;\npub mod preprocessor;\npub mod transpiler;\npub mod validator;\n\npub use error::{Result, ValidatorError};\npub use preprocessor::ValidatorPreprocessor;\n\\`\\`\\`\n\n### Step 9: Update src/main.rs with proper CLI\nFile: /Users/ryan/src/mdbook-validator/src/main.rs\n\n\\`\\`\\`rust\n//! mdbook-validator CLI entry point\n\nuse mdbook_validator::ValidatorPreprocessor;\n\nfn main() {\n    // Initialize tracing\n    tracing_subscriber::fmt::init();\n\n    // For now, just print version info\n    // Full mdBook integration will be implemented later\n    let preprocessor = ValidatorPreprocessor::new();\n    println!(\"mdbook-validator preprocessor: {}\", preprocessor.name());\n}\n\\`\\`\\`\n\n### Step 10: Verify compilation\nRun: \\`cargo build\\`\nRun: \\`cargo clippy --all-targets -- -D warnings\\`\nExpected: Both pass\n\n### Step 11: Commit changes\n\n## Success Criteria\n- [ ] All 7 source modules exist (error, config, parser, transpiler, container, validator, preprocessor)\n- [ ] src/lib.rs declares all modules with \\`pub mod\\`\n- [ ] src/lib.rs re-exports key types (Result, ValidatorError, ValidatorPreprocessor)\n- [ ] \\`cargo build\\` succeeds without errors\n- [ ] \\`cargo clippy --all-targets -- -D warnings\\` passes\n- [ ] No \\`#![allow(clippy::pedantic)]\\` at crate level\n\n## Anti-Patterns (FORBIDDEN)\n- NO \\`#![allow(clippy::pedantic)]\\` at crate level (defeats purpose)\n- NO stub implementations using \\`todo!()\\` or \\`unimplemented!()\\`\n- NO placeholder TODOs without clear comments\n- NO empty modules (each must have at least one type or function)\n- NO missing module declarations in lib.rs\n\nDependencies (2):\n  [parent-child] mdbook-validator-wkm (open): Epic: Project Scaffolding with Strict Linting and First-Class Testing [P0]\n  [blocks] mdbook-validator-i0t (closed): Task 4: Create .config/nextest.toml with test profiles [P0]\n\n## Key Considerations (SRE Review)\n\n**Edge Case: Clippy pedantic warnings**\n- Skeleton code may trigger clippy::pedantic warnings\n- Common issues: missing docs, unused fields, must_use\n- Allowed exceptions in Cargo.toml: missing_errors_doc, missing_panics_doc, module_name_repetitions, must_use_candidate\n- If new warnings appear, add targeted #[allow] on specific items, NOT crate-level\n\n**Edge Case: Unused imports**\n- Some imports may appear unused until implementation\n- Use #[allow(unused_imports)] on specific imports if needed\n- Do NOT use crate-level #\\![allow(dead_code)]\n\n**Reference: CLAUDE.md file organization**\n- Must match exactly: error.rs, config.rs, parser.rs, transpiler.rs, validator.rs, container.rs, preprocessor.rs\n- lib.rs must re-export key types for external use","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-26T12:23:03.192234-05:00","updated_at":"2025-11-26T12:31:49.695586-05:00","closed_at":"2025-11-26T12:31:49.695586-05:00","source_repo":".","dependencies":[{"issue_id":"mdbook-validator-q9r","depends_on_id":"mdbook-validator-wkm","type":"parent-child","created_at":"2025-11-26T12:23:09.021252-05:00","created_by":"ryan"},{"issue_id":"mdbook-validator-q9r","depends_on_id":"mdbook-validator-i0t","type":"blocks","created_at":"2025-11-26T12:23:09.545604-05:00","created_by":"ryan"}]}
{"id":"mdbook-validator-wkm","content_hash":"e5ba01f190891f970deb8abeac7e8606211dde94b4920d2a313d365d7eff6335","title":"Epic: Project Scaffolding with Strict Linting and First-Class Testing","description":"","design":"## Requirements (IMMUTABLE)\n\n1. **Cargo.toml** with all dependencies from CLAUDE.md plus:\n   - thiserror for typed errors\n   - cargo-husky dev-dependency with precommit-hook feature\n   - [lints.clippy] section with pedantic deny + common allowed exceptions\n\n2. **rustfmt.toml** with Edition 2021 style:\n   - max_width = 100\n   - imports_granularity = Module\n   - group_imports = StdExternalCrate\n\n3. **deny.toml** for dependency scanning:\n   - Deny unlicensed, deny unknown registry\n   - Allow MIT, Apache-2.0, BSD-2/3-Clause, ISC, Zlib, Unicode-3.0\n   - Warn on unmaintained, deny vulnerabilities\n\n4. **.config/nextest.toml** with profiles:\n   - default: parallel tests, 60s timeout\n   - docker-integration: sequential (test-threads=1), 5min timeout\n\n5. **Pre-commit hooks** (.cargo-husky/hooks/):\n   - pre-commit: cargo fmt --check, cargo clippy -D warnings, cargo nextest run\n   - pre-push: full test suite including Docker integration tests\n\n6. **Source files** (skeleton with proper module structure):\n   - src/main.rs - CLI entry point\n   - src/lib.rs - public API re-exports\n   - src/error.rs - thiserror error types\n   - src/preprocessor.rs - empty Preprocessor impl stub\n   - src/parser.rs, transpiler.rs, validator.rs, container.rs, config.rs - module stubs\n\n7. **Test structure**:\n   - tests/integration_tests.rs - integration test skeleton\n   - tests/fixtures/test-book/ - minimal mdbook for testing\n\n8. **Test-Driven Development (TDD) - MANDATORY**:\n   - ALL new functionality MUST follow RED-GREEN-REFACTOR cycle\n   - Write failing test FIRST, verify it fails, then implement minimal code\n   - No production code without a failing test\n   - Tests must fail for the expected reason (feature missing, not syntax error)\n   - Each test covers ONE behavior only\n   - Tests use real code (mocks only when unavoidable)\n\n## Success Criteria (MUST ALL BE TRUE)\n- [ ] cargo build compiles without warnings\n- [ ] cargo fmt --check passes\n- [ ] cargo clippy --all-targets -- -D warnings passes\n- [ ] cargo deny check passes (all dependencies licensed correctly)\n- [ ] cargo nextest run passes (even if tests are empty)\n- [ ] Pre-commit hook runs successfully on commit\n- [ ] File structure matches CLAUDE.md specification\n- [ ] All source files have proper module declarations\n- [ ] All new functionality has corresponding tests written BEFORE implementation (TDD)\n- [ ] Test coverage exists for: transpiler (strip_markers), parser (parse_info_string, extract_markers)\n\n## Anti-Patterns (FORBIDDEN)\n- NO edition = 2024 in rustfmt.toml (not stable yet)\n- NO #\\![allow(clippy::pedantic)] at crate level (defeats purpose)\n- NO :latest container tags in any config\n- NO Python dependencies (use cargo-husky, not pre-commit framework)\n- NO placeholder TODOs without clear next steps\n- NO skipping cargo-deny setup (license compliance required)\n- NO empty test files that do not compile\n- NO writing production code BEFORE writing a failing test (TDD violation)\n- NO tests that pass immediately without implementation (proves nothing)\n- NO keeping untested code as \"reference\" while writing tests\n\n## TDD Workflow (REQUIRED FOR ALL IMPLEMENTATION)\n\n### The RED-GREEN-REFACTOR Cycle\n\n1. **RED** - Write a failing test\n   - Test one behavior only\n   - Clear name describing expected behavior\n   - Run test, confirm it FAILS\n\n2. **Verify RED** - Watch it fail correctly\n   - Failure must be \"feature missing\" or \"assertion failed\"\n   - NOT syntax errors or typos\n   - If test passes immediately, you are testing existing behavior - fix the test\n\n3. **GREEN** - Write minimal code to pass\n   - Simplest code that makes test pass\n   - No extra features beyond what test requires\n   - No refactoring yet\n\n4. **Verify GREEN** - Watch it pass\n   - New test passes\n   - ALL existing tests still pass\n   - No warnings\n\n5. **REFACTOR** - Clean up while green\n   - Remove duplication\n   - Improve names\n   - Keep tests passing\n\n### Why TDD is Mandatory\n\n- Tests written after only verify remembered cases, not required behavior\n- \"Obvious\" code often has subtle bugs that TDD catches\n- TDD forces good design (hard to test = bad design)\n- Regression tests prevent future breakage\n- Documentation through examples\n\n## Approach\nCreate a production-ready Rust project scaffold that enforces code quality from day one. Use cargo-husky for git hooks (Rust-native), clippy pedantic for strict linting, cargo-deny for dependency safety, and cargo-nextest for fast parallel testing. All configuration follows 2024/2025 best practices research. ALL implementation follows TDD methodology.\n\n## Architecture\n- Binary crate (mdbook-validator) with library portion for testing\n- thiserror for typed errors (testable), anyhow for error context in main\n- Modules follow CLAUDE.md file organization exactly\n- Pre-commit validates formatting and linting; pre-push validates full test suite including Docker tests\n- Tests in tests/ directory for integration, unit tests in src/ modules\n\n## Context\n- CLAUDE.md specifies exact file organization and dependencies\n- testcontainers-rs 0.23 with blocking feature for container management\n- mdbook 0.4 for preprocessor interface\n- pulldown-cmark 0.13 + pulldown-cmark-to-cmark 21 for markdown\n\n## Current Test Coverage (TDD-implemented)\n\n| Module | Function | Tests | Status |\n|--------|----------|-------|--------|\n| transpiler.rs | strip_markers | 5 | Complete |\n| parser.rs | parse_info_string | 3 | Complete |\n| parser.rs | extract_markers | 3 | Complete |\n\n**Total: 11 tests**, all following RED-GREEN-REFACTOR cycle.","status":"open","priority":0,"issue_type":"epic","created_at":"2025-11-25T17:47:03.653513-05:00","updated_at":"2025-11-26T12:47:58.57067-05:00","source_repo":"."}
{"id":"mdbook-validator-x82","content_hash":"b8f48434aa6257424da1f6f877fe3f6e7d0b1384fddab94b92770214392fc03c","title":"Task 3: Create deny.toml for dependency scanning","description":"","design":"## Goal\nCreate deny.toml for cargo-deny dependency scanning as specified in epic requirements.\n\n## Effort Estimate\n30 minutes\n\n## Context\nCompleted Task 1: Cargo.toml with dependencies\nCompleted Task 2: rustfmt.toml with Edition 2021 style\n\n## Implementation Checklist\n\n### Step 1: Check if cargo-deny is installed\nRun: `cargo deny --version`\nIf not installed: `cargo install cargo-deny`\n\n### Step 2: Create deny.toml\nCreate file at: `/Users/ryan/src/mdbook-validator/deny.toml`\n\nContent:\n```toml\n[graph]\nall-features = true\n\n[advisories]\ndb-path = \"~/.cargo/advisory-db\"\nvulnerability = \"deny\"\nunmaintained = \"warn\"\nyanked = \"warn\"\nnotice = \"warn\"\nignore = []\n\n[licenses]\nunlicensed = \"deny\"\nallow = [\n    \"MIT\",\n    \"Apache-2.0\",\n    \"Apache-2.0 WITH LLVM-exception\",\n    \"BSD-2-Clause\",\n    \"BSD-3-Clause\",\n    \"ISC\",\n    \"Zlib\",\n    \"Unicode-3.0\",\n    \"Unicode-DFS-2016\",\n    \"MPL-2.0\",\n]\ncopyleft = \"warn\"\nconfidence-threshold = 0.8\nexceptions = []\n\n[bans]\nmultiple-versions = \"warn\"\nwildcards = \"deny\"\nhighlight = \"all\"\nworkspace-default-features = \"allow\"\nexternal-default-features = \"allow\"\n\n[sources]\nunknown-registry = \"deny\"\nunknown-git = \"warn\"\nallow-registry = [\"https://github.com/rust-lang/crates.io-index\"]\n```\n\n### Step 3: Run cargo deny check\nRun: `cargo deny check`\nExpected: Exit 0 (or warnings only, no errors)\n\nIf failures occur:\n- License issues: Check if license is in allow list, add if standard OSS\n- Advisory issues: Check RUSTSEC advisory, decide if exception needed\n- Source issues: Verify registry is crates.io\n\n### Step 4: Commit changes\n\n## Success Criteria\n- [ ] deny.toml exists at project root\n- [ ] `cargo deny check` exits 0 (no denials, warnings OK)\n- [ ] `grep 'unlicensed.*deny' deny.toml` returns match\n- [ ] `grep 'unknown-registry.*deny' deny.toml` returns match\n- [ ] `grep 'vulnerability.*deny' deny.toml` returns match\n- [ ] `grep 'unmaintained.*warn' deny.toml` returns match\n\n## Key Considerations (SRE Review)\n\n**Edge Case: cargo-deny not installed**\n- Check with `cargo deny --version` first\n- Install with `cargo install cargo-deny`\n- First run downloads advisory-db (~30s)\n\n**Edge Case: Dual-licensed dependencies**\n- Many crates are \"MIT OR Apache-2.0\"\n- cargo-deny handles this correctly if either is in allow list\n- Both MIT and Apache-2.0 are in our allow list\n\n**Edge Case: RUSTSEC advisories on dependencies**\n- Check https://rustsec.org/ for known advisories\n- If critical advisory on our deps, may need to update dependency\n- Use `cargo deny check advisories` to check just advisories\n\n**Edge Case: Unicode licenses**\n- unicode-ident crate uses Unicode-3.0 and Unicode-DFS-2016\n- Both must be in allow list\n- Already included in our config\n\n**Why these specific licenses?**\n- MIT, Apache-2.0: Most Rust ecosystem\n- BSD-2/3-Clause, ISC: Common permissive\n- Zlib: Compression libraries\n- Unicode-3.0, Unicode-DFS-2016: Unicode libraries\n- MPL-2.0: Some networking crates (tokio ecosystem)\n- Apache WITH LLVM-exception: LLVM-based crates\n\n## Anti-Patterns (FORBIDDEN)\n- NO skipping cargo-deny setup (epic explicitly requires)\n- NO allowing all licenses (defeats purpose)\n- NO ignoring vulnerabilities (security risk)\n- NO `deny = false` on any security check\n- NO empty allow list (would deny everything)","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-26T12:07:38.532439-05:00","updated_at":"2025-11-26T12:18:45.262207-05:00","closed_at":"2025-11-26T12:18:45.262207-05:00","source_repo":".","dependencies":[{"issue_id":"mdbook-validator-x82","depends_on_id":"mdbook-validator-wkm","type":"parent-child","created_at":"2025-11-26T12:07:43.936111-05:00","created_by":"ryan"},{"issue_id":"mdbook-validator-x82","depends_on_id":"mdbook-validator-d4u","type":"blocks","created_at":"2025-11-26T12:07:45.74563-05:00","created_by":"ryan"}]}
